{% extends base_template %}
{% load static compress inv_utils %}
{% load crispy_forms_tags crispy_forms_filters %}
{% block body_class %}body--invoice{% endblock %}

{% block content %}
  <div id="invoice-container" class="ui basic segment">
    {% if not print %}
    <div id="settings-rail" class="left ui rail">
      <div id="sticky-settings" class="ui sticky">
        <div class="ui top attached block header">
          <h2>Настройки</h2>
        </div>
        <div class="ui attached segment">
          <select class="ui search dropdown fluid _mbxs">
            <option value="1">Български</option>
            <option value="2">English</option>
          </select>

          <select class="ui search dropdown fluid _mbxs">
            <option value="">Валута</option>
            <option value="1">($) Долари</option>
            <option value="2">(&euro;) Евро</option>
          </select>
        </div>
        <div class="ui bottom items attached header _oh">
          {% if pk %}
            <a href="{% url 'print' pk %}" class="ui left floated button primary tiny noprint" role="button">Принтиране</a>
          {% endif %}

          {% if pk %}
            <a href="{% url 'delete' pk %}" class="ui right floated button tiny red" role="button">Изтриване</a>
          {% endif %}
          <button type="submit" href="{% url 'list' %}" class="ui right floated button noprint tiny green" role="button">Запазване</button>
        </div>
      </div>
    </div>
    {% endif %}
    <form class="ui tiny form" method="POST" action="" id="invoice_app">
      {% csrf_token %}

      <input name="invoice_type" type="hidden" value="{{ invoice_type }}"/>

      {% for field, errors in form.errors.items %}
        {% for error in errors %}
          <div class="row alert alert-warning" role="alert">{{ field }}: {{ error }}</div>
        {% endfor %}
      {% endfor %}

      <div class="ui grid">

        <div class="equal width row _pb0">
          <div class="column">
            <h1>{% if invoice_type == 'proforma' %}Проформа{% else %}Фактура{% endif %}
              <small>оригинал</small>
            </h1>
          </div>
          <div class="column">
            {{ form.number|as_crispy_field }}
            {{ form.released_at|as_crispy_field }}
            {{ form.taxevent_at|as_crispy_field }}
          </div>
        </div>

        <div class="equal width row _pb0">
          <div class="column">
            {{ form.client_name|as_crispy_field }}
            {{ form.client_eik|as_crispy_field }}
            {{ form.client_dds|as_crispy_field }}
            {{ form.client_city|as_crispy_field }}
            {{ form.client_address|as_crispy_field }}
            {{ form.client_mol|as_crispy_field }}
          </div>
          <div class="column">
            {{company_form.name|as_crispy_field}}
            {{company_form.eik|as_crispy_field}}
            {{company_form.dds|as_crispy_field}}
            {{company_form.city|as_crispy_field}}
            {{company_form.address|as_crispy_field}}
            {{company_form.mol|as_crispy_field}}
          </div>
        </div>

        <div class="equal width row _pb0">
          <div class="column">{% include "invoices/_invoice_details.html" %}</div>
        </div>

        <div class="equal width row _pb0">
          <div class="column">
            {{ form.payment_type|as_crispy_field }}
            {{ form.payment_iban|as_crispy_field }}
            {{ form.payment_swift|as_crispy_field }}
            {{ form.payment_bank|as_crispy_field }}
            {{ form.accepted_by|as_crispy_field }}
          </div>
          <div class="column">
            {{ form.tax_base|as_crispy_field }}
            {{ form.dds_percent|as_crispy_field }}
            {{ form.total|as_crispy_field }}
            {{ form.verbally|as_crispy_field }}
            {{ form.created_by|as_crispy_field }}
          </div>
        </div>

        <div class="equal width row">
          <div class="column">
            <div class="field">
              <label>Бележка:</label>
              <input name="note" value="{{ form.note.value }}" type="text">
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <script type="text/javascript">window.formset = {{ formset|safe }};</script>
  <script src="{% static "invoices/js/app.js" %}"></script>

{% endblock %}
